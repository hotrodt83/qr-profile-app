(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[231],{4374:function(e,n,a){Promise.resolve().then(a.bind(a,7998))},7998:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return m}});var t=a(3827),i=a(4090),s=a(8792),r=a(7907),l=a(4599);async function d(e,n){let{data:a,error:t}=await e.from("profiles").select("id,username,whatsapp,facebook,instagram,tiktok,telegram,linkedin,email,phone,x,website,updated_at").eq("id",n).maybeSingle();return t?null:a}async function c(e,n,a){let t={id:n,...a,updated_at:new Date().toISOString()};return e.from("profiles").upsert(t,{onConflict:"id"}).select().maybeSingle()}var u=a(4332);function o(){let e={username:""};return u.$.forEach(n=>{let{key:a}=n;e[a]=""}),e}function m(){var e;let n=(0,r.useRouter)(),a=(0,i.useMemo)(()=>{try{return(0,l.A)()}catch(e){return null}},[]),[m,h]=(0,i.useState)(null),[f,p]=(0,i.useState)(!0),[x,g]=(0,i.useState)(!1),[v,j]=(0,i.useState)(null),[N,b]=(0,i.useState)(o),[S,_]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(!a){b(o()),p(!1);return}let e=!1;return(async()=>{try{let{data:{user:t}}=await a.auth.getUser();if(e)return;if(!t){p(!1),n.replace("/auth");return}h(t.id);let i=null;try{i=await d(a,t.id)}catch(e){}if(e)return;if(i){let e={username:null!=i.username?String(i.username):""};u.$.forEach(n=>{let{key:a}=n,t=i[a];e[a]=null!=t?String(t):""}),b(e)}else b(o())}catch(n){if(e)return;_(n instanceof Error?n.message:"Something went wrong."),b(o())}finally{e||p(!1)}})(),()=>{e=!0}},[n,a]);let y=null===a,E=!!(a&&m);async function k(e){var n;if(e.preventDefault(),!E)return;g(!0),j(null);let t={username:(null===(n=N.username)||void 0===n?void 0:n.trim())||null};u.$.forEach(e=>{var n;let{key:a}=e,i=null===(n=N[a])||void 0===n?void 0:n.trim();t[a]=""===i?null:i});let{error:i}=await c(a,m,t);if(g(!1),i){j("Error saving. Try again.");return}j("Saved"),setTimeout(()=>j(null),2500)}return f?(0,t.jsx)("main",{className:"edit-page",children:(0,t.jsx)("div",{className:"edit-inner",children:(0,t.jsx)("p",{style:{color:"rgba(255,255,255,0.7)"},children:"Loading…"})})}):y||m||S?!y&&S?(0,t.jsx)("main",{className:"edit-page",children:(0,t.jsxs)("div",{className:"edit-inner",children:[(0,t.jsx)("p",{style:{color:"rgba(255,255,255,0.9)",marginBottom:8},children:"Could not load session"}),(0,t.jsx)("p",{style:{color:"rgba(255,255,255,0.6)",fontSize:14,marginBottom:16},children:S}),(0,t.jsx)(s.default,{href:"/auth",className:"edit-back",children:"Sign in"}),(0,t.jsx)("span",{style:{margin:"0 8px"},children:"\xb7"}),(0,t.jsx)(s.default,{href:"/",className:"edit-back",children:"Back to home"})]})}):(0,t.jsx)("main",{className:"edit-page",children:(0,t.jsxs)("div",{className:"edit-inner",children:[y&&(0,t.jsxs)("div",{className:"edit-banner",role:"alert",children:[(0,t.jsx)("strong",{children:"Supabase not configured."})," Copy ",(0,t.jsx)("code",{children:".env.example"})," to ",(0,t.jsx)("code",{children:".env.local"})," and add your ",(0,t.jsx)("code",{children:"NEXT_PUBLIC_SUPABASE_URL"})," and ",(0,t.jsx)("code",{children:"NEXT_PUBLIC_SUPABASE_ANON_KEY"})," to sign in and save."]}),(0,t.jsx)("h1",{className:"edit-title",children:"Edit your links"}),(0,t.jsx)("p",{className:"edit-subtitle",children:"Add your social and contact links. They will appear on your public QR profile."}),(0,t.jsxs)("form",{onSubmit:k,className:"edit-form",children:[(0,t.jsxs)("div",{className:"edit-grid",children:[(0,t.jsxs)("div",{className:"edit-row",children:[(0,t.jsx)("span",{className:"edit-icon","aria-hidden":!0}),(0,t.jsx)("label",{className:"edit-label",htmlFor:"username",children:"Username"}),(0,t.jsx)("input",{id:"username",type:"text",placeholder:"for /u/username",value:null!==(e=N.username)&&void 0!==e?e:"",onChange:e=>b(n=>({...n,username:e.target.value})),className:"edit-input",autoComplete:"off"})]}),u.$.map(e=>{var n;let{key:a,label:i,placeholder:s,Icon:r}=e;return(0,t.jsxs)("div",{className:"edit-row",children:[(0,t.jsx)("span",{className:"edit-icon","aria-hidden":!0,children:(0,t.jsx)(r,{size:20,className:"edit-icon-svg"})}),(0,t.jsx)("label",{className:"edit-label",htmlFor:a,children:i}),(0,t.jsx)("input",{id:a,type:"text",placeholder:s,value:null!==(n=N[a])&&void 0!==n?n:"",onChange:e=>b(n=>({...n,[a]:e.target.value})),className:"edit-input",autoComplete:"off"})]},a)})]}),(0,t.jsxs)("div",{className:"edit-actions",children:[(0,t.jsx)("button",{type:"submit",disabled:x||!E,className:"edit-save",children:x?"Saving…":y?"Save (sign in required)":"Save"}),v&&(0,t.jsx)("span",{className:"edit-toast",children:v})]})]}),(0,t.jsx)(s.default,{href:"/",className:"edit-back",children:"← Back to home"})]})}):(0,t.jsx)("main",{className:"edit-page",children:(0,t.jsxs)("div",{className:"edit-inner",children:[(0,t.jsx)("p",{style:{color:"rgba(255,255,255,0.7)",marginBottom:16},children:"Redirecting to sign in…"}),(0,t.jsx)(s.default,{href:"/auth",className:"edit-back",children:"Go to sign in"})]})})}},4599:function(e,n,a){"use strict";a.d(n,{A:function(){return r},e:function(){return l}});var t=a(7688);let i="https://opqsvhuzitldddvkurpd.supabase.co",s="sb_publishable_mj_UG9I9lbzanA0PUKTJ_A_Z0_0yiWs";function r(){if(!i||!s)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY");return(0,t.eI)(i,s)}function l(){return r()}},8792:function(e,n,a){"use strict";a.d(n,{default:function(){return i.a}});var t=a(5250),i=a.n(t)}},function(e){e.O(0,[250,436,332,971,69,744],function(){return e(e.s=4374)}),_N_E=e.O()}]);